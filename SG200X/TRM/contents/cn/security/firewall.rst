安全除错防火墙
--------------

为了提供除错或测试时读取或控制芯片内部相关功能，芯片提供了数种除错接口，如 JTAG、I2C 等不同的外部接口。若缺乏适当的保护机制，这些接口很轻易地会被利用以直接或间接的方式，来攻击芯片安全机制或读取内部需保密的信息。为了保护及控制这些接口，芯片采用了安全除错防火墙措施。

概述
~~~~

芯片支持三种主要的除错接口，

1. RISCV JTAG: RISCV 处理器内建调试接口，允许使用者通过 JTAG 接口访问 ARM 内部寄存器

2. I2C: 芯片提供除错接口

3. Test interface: 芯片提供生产测试专用调试接口

对于 JTAG/I2C 接口，安全除错防火墙针对其访问提供特定保护控制

对 Test interface 接口，安全除错接口则其访问提供一类独立的保护控制 (Test 访问)

针对这些除错类别 ，安全除错防火墙提供三种连接控制状态

- 开放 (Open): 允许外部通过接品连入，不施加额外控制。

- 保护 (Protected):不允许外部通过接品连入, 直到由外部通过 I2C 接口输入对应密码解开保护。

- 关闭 (Closed): 不允许外部通过该接口连入，无法由其他方法再次开启。

状态查讯及密码输入接口 (I2C)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

安全除错防火墙提供一个独立运作的 I2C 接口，供芯片外部通过 I2C 来查讯除错接口当前状态及输入相对应密码来将在保护状态的接口重新开启。外部需指定正确的 I2C ID 来连接接防火墙接口。

I2C 接口寄存器位址如下

.. include:: ./firewall_i2c_query_interface.table.rst

状态查讯及密码输入流程
~~~~~~~~~~~~~~~~~~~~~~

状态查讯流程
^^^^^^^^^^^^

- (步骤一) 控制外部 I2C 发出开始信号。

- (步骤二) 由 I2C 发出防火墙 I2C ID (预设 0x56)。

- (步骤三) 由 I2C 读取位址 0x04001A94, 以获得当前除错接口保护状态。

密码输入流程
^^^^^^^^^^^^

- (步骤一) 控制外部 I2C 发出开始信号。

- (步骤二) 由 I2C 发出除错接口防火墙的 I2C ID (预设 0x56)。

- (步骤三) 由 I2C 读取位址 0x04001A80 / 0x04001A84, 以获得设备序号 Device ID, 读取 0x04001A88 以获得市场区别编号。

- (步骤四) 经由设备序号及市场区别编号，准备各个类别相对应的解锁密码。

- (步骤五) 由 I2C 读取位址 0x94, 以获得当前除错接口保护状态，碉认是否上锁。

- (步骤六) 以非安全除错接口为例，由 I2C 将非安全密码写入位址 0x04001A00 / 0x04001A04 / 0x04001A08 / 0x04001A0C。

- (步骤七) I2C 写任意值至位址 0x04001A10, 更新密码比较值。

- (步骤八) 由 I2C 读取位址 0x94, 以获得当前除错接口保护状态, 确认是否解锁。
