SG2042 Benchmark测试方法
========================

测试环境
--------

SG2042 x8 EVB评估板
~~~~~~~~~~~~~~~~~~~~~

-  内存：DDR RDIMM 3200 128G
-  CPU：2.0GHz

kunpeng920服务器
~~~~~~~~~~~~~~~~~~

-  内存：DDR RDIMM 2933 512G
-  CPU：2.6GHz

测试项目
--------

+-----------------------+-----------------------+-----------------------+
| 测试项目              | 测试状态              | 现存问题和进展        |
+=======================+=======================+=======================+
| spec2017              | DONE                  |                       |
+-----------------------+-----------------------+-----------------------+
| spec2006              | DOING                 | fprate未测试          |
+-----------------------+-----------------------+-----------------------+
| unixbench             | DONE                  |                       |
+-----------------------+-----------------------+-----------------------+
| coremark              | DONE                  |                       |
+-----------------------+-----------------------+-----------------------+
| stream                | DONE                  |                       |
+-----------------------+-----------------------+-----------------------+
| cache latency         | DONE                  |                       |
+-----------------------+-----------------------+-----------------------+
| core-core latency     | DONE                  |                       |
+-----------------------+-----------------------+-----------------------+
| litmus                | DOING                 | Failure:              |
|                       |                       | ISA-DEP-WR-ADDR，     |
|                       |                       | 除此测试项，其他测试  |
|                       |                       | 项已经完成，无问题。  |
+-----------------------+-----------------------+-----------------------+
| sysbench              | DONE                  |                       |
+-----------------------+-----------------------+-----------------------+
| ltp                   | DOING                 | full                  |
|                       |                       | test已                |
|                       |                       | 经跑完，失败项分析中  |
+-----------------------+-----------------------+-----------------------+
| stress-ng             | DOING                 | 只压测了cp            |
|                       |                       | u、vm，其他测试项待测 |
+-----------------------+-----------------------+-----------------------+
| fio                   | DONE                  |                       |
+-----------------------+-----------------------+-----------------------+
| redis benchmark       | DONE                  |                       |
+-----------------------+-----------------------+-----------------------+

测试方法
--------

spec2017 & spec2006
~~~~~~~~~~~~~~~~~~~~~

Standard Performance Evaluation
Corporation公司提供测试,测试结果示例如下所示

.. figure:: 2024-12-02-13-29-00.png
   :alt: spec2017测试结果


unixbench
~~~~~~~~~~~

测试结果示例如下测试方法待补充 

.. figure:: 2024-12-02-13-30-41.png
   :alt: unixbench

coremark
~~~~~~~~~~

测试结果示例如下测试方法待补充 

.. figure:: 2024-12-02-13-32-09.png
   :alt: unixbench

stream
~~~~~~~~

4种测试模式

======== ============ =============
测试模式 SG2042       kunpeng920
======== ============ =============
copy     37630.3 MB/s 105829.1 MB/s
Scale    37922.4 MB/s 93430.6 MB/s
Add      39089.5 MB/s 97665.0 MB/s
Triad    38931.9 MB/s 91497.5 MB/s
======== ============ =============

根据不同的CPU节点设置不同参数

+-------------+-------------+-------------+-------------+-------------+
| 测试设置    | copy        | scale       | add         | triad       |
+=============+=============+=============+=============+=============+
| cpu0_node0  | 8518 MB/s   | 8784 MB/s   | 8394 MB/s   | 8377 MB/s   |
+-------------+-------------+-------------+-------------+-------------+
| cpu0_node4  | 2680 MB/s   | 2693 MB/s   | 2345 MB/s   | 2359 MB/s   |
+-------------+-------------+-------------+-------------+-------------+
| cpu0        | 32037 MB/s  | 42554 MB/s  | 36749 MB/s  | 35151 MB/s  |
| -63_node0-3 |             |             |             |             |
+-------------+-------------+-------------+-------------+-------------+
| cpu0        | 6854 MB/s   | 10086 MB/s  | 9598 MB/s   | 10024 MB/s  |
| -63_node4-7 |             |             |             |             |
+-------------+-------------+-------------+-------------+-------------+
| cpu0-127    | 53568 MB/s  | 53368 MB/s  | 58949 MB/s  | 59681 MB/s  |
+-------------+-------------+-------------+-------------+-------------+

测试结果示例如下

测试方法待补充，图中编译参数有乱码

.. figure:: 2024-12-02-13-35-30.png
   :alt: stream测试结果

   测试结果

cache bench
~~~~~~~~~~~~~

使用套间 `Phoronix Test Suite <https://github.com/phoronix-test-suite/phoronix-test-suite/>`__
可能的测试方法如下

.. code:: bash

   git clone https://github.com/phoronix-test-suite/phoronix-test-suite.git
   cd phoronix-test-suite
   phoronix-test-suite benchmark cachebench

core-core latency
~~~~~~~~~~~~~~~~~~~

测试结果示例如下

测试方法待补充

.. figure:: 2024-12-02-14-08-23.png
   :alt: 测试结果

   测试结果

litmus
~~~~~~~~

测试准备
^^^^^^^^^^^

`RISCV Litmus 标准测试仓库 <https://github.com/litmus-tests/litmus-tests-riscv>`__

安装工具
^^^^^^^^^^^

-  ``herdtools7``:编译Litmus的的过程需要使用herdtools7工具，根据herdtools7说明文档安装，其中可能需要安装Ocaml
   和Opam 等包管理工具

.. code:: bash

   sudo apt-get install opam
   opam init && opam update && opam upgrade
   opam install herdtools7

-  ``fedora``

.. code:: bash

   sudo dnf install glibc-static

编译测试用例
^^^^^^^^^^^^^^^

.. code:: bash

   git clone https://github.com/litmus-tests/litmus-tests-riscv
   cd litmus-tests-riscv
   make CORES=64 hw-tests

sysbench
~~~~~~~~~~

测试结果示例如下

测试方法待补充

.. figure:: 2024-12-02-13-55-33.png
   :alt: 测试结果

   测试结果

ltp
~~~~~

stress-ng
~~~~~~~~~~~~

====== ======================== ========
压测项 运行命令                 测试结果
====== ======================== ========
CPU    stress-ng –cpu 64 -t 30m PASS
VM     stress-ng –vm 64 -t 30m  PASS
====== ======================== ========

fio
~~~~~~

-  读

.. code:: bash

   sudo fio -filename=/dev/nvme0n1 -direct=1 -iodepth 1 -thread -rw=read -ioengine=psync -bs=1M -size=10G -numjobs=64 -runtime=60 -group_reporting -name=nvme

-  写

.. code:: bash

   sudo fio -filename=/dev/nvme0n1 -direct=1 -iodepth 1 -thread -rw=wirte -ioengine=psync -bs=1M -size=10G -numjobs=64 -runtime=60 -group_reporting -name=nvme

redis
~~~~~~~~

.. code:: bash

   redis-benchmark -n 100000  -q

DMIPS
~~~~~~~~

`下载源码 <https://github.com/ARM-software/workload-automation/tree/master/wa/workloads/dhrystone/src>`__

进入目录

.. code:: bash

   make
   ./dhrystone -I 100

网卡测试
~~~~~~~~~~~

.. |测试结果| image:: 2024-12-02-13-30-41.png
.. |image1| image:: 2024-12-02-13-32-09.png


   .. +-----------------------+-----------------------+-----------------------+
   .. | 测试项目               | 测试状态              | 现存问题和进展            |
   .. +=======================+=======================+=======================+
   .. | spec2017              | DONE                  |                       |
   .. +-----------------------+-----------------------+-----------------------+
   .. | spec2006              | DOING                 | fprate未测试           |
   .. +-----------------------+-----------------------+-----------------------+
   .. | unixbench             | DONE                  |                       |
   .. +-----------------------+-----------------------+-----------------------+
   .. | coremark              | DONE                  |                       |
   .. +-----------------------+-----------------------+-----------------------+
   .. | stream                | DONE                  |                       |
   .. +-----------------------+-----------------------+-----------------------+
   .. | cache latency         | DONE                  |                       |
   .. +-----------------------+-----------------------+-----------------------+
   .. | core-core latency     | DONE                  |                       |
   .. +-----------------------+-----------------------+-----------------------+
   .. | litmus                | DOING                 | Failure:ISA-DEP-WR-ADD|
   .. |                       |                       | R除此测试项,其他测试     |
   .. |                       |                       | 项已经完成,无问题。      |
   .. |                       |                       |                       |
   .. +-----------------------+-----------------------+-----------------------+
   .. | sysbench              | DONE                  |                       |
   .. +-----------------------+-----------------------+-----------------------+
   .. | ltp                   | DOING                 | fulltest已经跑完,失败   |
   .. |                       |                       | 分析中                 |
   .. |                       |                       |                       |
   .. +-----------------------+-----------------------+-----------------------+
   .. | stress-ng             | DOING                 | 只压测了cpu、vm,其他测试 |
   .. |                       |                       | 项待测                 |
   .. +-----------------------+-----------------------+-----------------------+
   .. | fio                   | DONE                  |                       |
   .. +-----------------------+-----------------------+-----------------------+
   .. | redis benchmark       | DONE                  |                       |
   .. +-----------------------+-----------------------+-----------------------+